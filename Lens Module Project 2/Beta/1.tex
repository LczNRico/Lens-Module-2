Intersect(RefractionRay_{Final},eq1)

Intersect(

  If(   %a,if,1  
    (n_{Lens})/(n_{Out})) sin(
      Angle(
        Ray(
          Incident_{1st,InRe},

          Rotate_{1st,Refraction}
        ),

        If( %b,if,1        
        plzdtyA, %b,if,c,1
        
        Line(A,Incident_{2nd,InRe}), %b,if,r,1
        
        plzdtyB, %b,if,c,2
        
        Line(B,Incident_{2nd,InRe}) %b,if,r,2    
        )      
      )
    )â‰¥1, %a,if,c,1

    Ray(Incident_{3rd,TIR,InRe},Rotate_{3rd,Refraction}), %a,if,r,1

    Ray(  
      if( %z,if,1
      
        isdefined(Intersect(RefractionRay_{1},Arc_{2nd,InRe},1)), %z,if,c,1

        Intersect(RefractionRay_{1},Arc_{2nd,InRe},1), %z,if,r,1

        isdefined(Intersect(RefractionRay_{1},Arc_{2nd,InRe},2)), %z,if,c,2
        
        Intersect(RefractionRay_{1},Arc_{2nd,InRe},2) %z,if,r,2
    ), %a,if,r,2
  
    Rotate_{2nd,Refraction})),
  
  eq1
  
)